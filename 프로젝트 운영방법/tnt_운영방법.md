# Today News Talk
<div align="center">
    <img src="https://img.shields.io/badge/Ubuntu-20.04.3 LTS-E95420?style=flat&logo=Ubuntu&logoColor=white"/><img src="https://img.shields.io/badge/MySQL-8.0.28-4479A1?style=flat&logo=MySQL&logoColor=white"/><img src="https://img.shields.io/badge/NGINX-1.18.0(ubuntu)-009639?style=flat&logo=NGINX&logoColor=white"/><br/><img src="https://img.shields.io/badge/Vue.js-3.2.31-4FC08D?style=flat&logo=Vue.js&logoColor=white"/><img src="https://img.shields.io/badge/HTML5-E34F26?style=flat&logo=HTML5&logoColor=white"/><img src="https://img.shields.io/badge/CSS3-1572B6?style=flat&logo=CSS3&logoColor=white"/><img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=flat&logo=JavaScript&logoColor=white"/><br/><img src="https://img.shields.io/badge/GitLab-FCA121?style=flat&logo=GitLab&logoColor=white"/><img src="https://img.shields.io/badge/Jira-0052CC?style=flat&logo=Jira Software&logoColor=white"/><img src="https://img.shields.io/badge/Notion-000000?style=flat&logo=Notion&logoColor=white"/><img src="https://img.shields.io/badge/Mattermost-0058CC?style=flat&logo=Mattermost&logoColor=white"/></div>


![Spring](https://img.shields.io/badge/spring-%236DB33F.svg?style=for-the-badge&logo=spring&logoColor=white) ![Jenkins](https://img.shields.io/badge/jenkins-%232C5263.svg?style=for-the-badge&logo=jenkins&logoColor=white) ![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white)![MariaDB](https://img.shields.io/badge/MariaDB-003545?style=for-the-badge&logo=mariadb&logoColor=white)![Redis](https://img.shields.io/badge/redis-%23DD0031.svg?style=for-the-badge&logo=redis&logoColor=white) ![AWS](https://img.shields.io/badge/AWS-%23FF9900.svg?style=for-the-badge&logo=amazon-aws&logoColor=white)![Bootstrap](https://img.shields.io/badge/bootstrap-%23563D7C.svg?style=for-the-badge&logo=bootstrap&logoColor=white)

# ì„œë¹„ìŠ¤ ì†Œê°œ
ë‹¹ì¼ ë‰´ìŠ¤ë“¤ì˜ ì£¼ìš” í‚¤ì›Œë“œ ë° í†µê³„ë¥¼ ë³´ì—¬ì£¼ê³ 
ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ì˜ ì „ë°˜ì ì¸ ê¸°ì‚¬ê²½í–¥ì„ 
í•œ ëˆˆì— ì•Œì•„ë³¼ ìˆ˜ ìˆë„ë¡ 
ê¸°ì‚¬ë¥¼ ê°€ê³µí•˜ì—¬ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤


## ê¸°ë³¸ ê°œë°œ í™˜ê²½ ğŸ’¾ 

1. ### JAVA 11
2. ### Front-end
    - Vue3
    - Vuex4    
    - Bootstrap 5
3. ### Back-end
    - SpringBoot
    - JPA
4. ### DB
    - MariaDB
    - Redis
5. ### ê¸°íƒ€ ê¸°ìˆ 
    - Jenkins
    - AWS
    - Docker

## í¬íŠ¸ ì •ë³´ âš™
> Backend : 9999
> Mariadb : 3307
> Redis : 3308
> Jenkins : 9090, 50000
> Hadoop : 8088


## êµ¬ë™ì‹œí‚¤ê¸° ìœ„í•´ í•„ìš”í•œ ê²ƒë“¤ ğŸ‘©â€ğŸ«
1. AWS DOCKER ì„¤ì¹˜
2. Certbot ì„¤ì¹˜
3. Java 11 ì„¤ì¹˜
4. nginx ì„¤ì¹˜
5. MariaDB Dockerë¡œ ì„¤ì¹˜
6. Redis ì„¤ì¹˜
7. Jenkins ì„¤ì¹˜
8. Hadoop ì—ì½”ì‹œìŠ¤í…œ êµ¬ì¶•

## ìš´ì˜ë©”ë‰´ì–¼ ğŸ‰
### ê°œë°œ í™˜ê²½
ë„ë©”ì¸ ì£¼ì†Œ ì˜ˆì‹œ : j6b201.p.ssafy.io  
AWS í™˜ê²½ : Ubuntu 20.04 LTS

[1. Docker ì„¤ì¹˜](#Docker-ì„¤ì¹˜)  
[2. Docker-Compose ì„¤ì¹˜](#Docker-Compose-ì„¤ì¹˜)  
[3. Certbot ì„¤ì •](#Certbot-ì„¤ì •)  
[4. DB ì„¤ì¹˜](#DB-ì„¤ì¹˜)
[5. Redis ì„¤ì¹˜](#Redis-ì„¤ì¹˜)
[6. Nginx ì„¤ì •](#Nginx-ì„¤ì •)  
[7. ë°°í¬ ìë™í™” í•˜ê¸°](#Jenkins-ë°°í¬)  
[8. Hadoop ì„¤ì¹˜](#Hadoop-ì„¤ì¹˜)  
[9. Sqoop ì„¤ì¹˜](#Sqoop-ì„¤ì¹˜)  
[10. Oozie ì„¤ì¹˜](#Oozie-ì„¤ì¹˜)  
## Docker ì„¤ì¹˜
```bash
# íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt-get update
# ë„ì»¤ ì„¤ì¹˜
sudo apt-get install docker.io -y
# docker ì„œë¹„ìŠ¤ ì‹¤í–‰
sudo service docker start
# ê¶Œí•œ ë¶€ì—¬
sudo chmod 666 /var/run/docker.sock
```
---
## ğŸˆ
## Docker-Compose-ì„¤ì¹˜
1. docker-compose ìµœì‹  ë²„ì „ ì„¤ì¹˜
```bash
sudo curl -L https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose
```

2. docker-compose ê¶Œí•œ ì„¤ì •
```bash
sudo chmod +x /usr/local/bin/docker-compose
```

3. docker version í™•ì¸
```bash
docker-compose version
```
---
## ğŸ†
## DB ì„¤ì¹˜
1.  
```bash
docker pull mariadb
```
2.  
```bash
# HoneyShool ì—ì„œëŠ” DB port 3310 ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.
# ë‹¤ë¥¸ í¬íŠ¸ ì„¤ì • ì‹œ HoneySchool ì†ŒìŠ¤ì—ì„œ Backend/src/main/resources/application.properties ì—ì„œ DB í¬íŠ¸ ë³€ê²½
docker run --name ì»¨í…Œì´ë„ˆì´ë¦„ -d -p 3307:3307 -e MYSQL_ROOT_PASSWORD=ë¹„ë²ˆ mariadb
```
- -d : ì»¨í…Œì´ë„ˆë¥¼ ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰
- -p : 3306:3306 í˜¸ìŠ¤íŠ¸-ì»¨í…Œì´ë„ˆ ê°„ í¬íŠ¸ ì—°ê²°. í˜¸ìŠ¤íŠ¸ì—ì„œ 3306í¬íŠ¸ ì ‘ì† ì‹œ ì¼„í…Œì´ë„ˆ 3306 í”„í† ë¡œ í¬ì›Œë”© ë¨.
- -e : MYSQL_ROOT_PASSWORD=ë¹„ë²ˆ : ì»¨í…Œì´ë„ˆ ë‚´ í™˜ê²½ë³€ìˆ˜ ì„¤ì •. root ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ mariadbë¡œ ì§€ì •
- mariadb : ë‹¤ìš´ë¡œë“œ ë°›ì€ ì´ë¯¸ì§€ ì´ë¦„  

3. bash ì ‘ì†
```bash
docker exec -it ì»¨í…Œì´ë„ˆID bash
```
4. mariadb ì ‘ì†
```bash
mysql -u root -p
```

### ì„¤ì • íŒŒì¼ë³€ê²½
character SET ë° ì‹œê°„ ì„¤ì •  

1. ì„¤ì • ë“¤ì–´ê°€ê¸°
```bash
vim etc/mysql/my.cnf
```
2. ì›í•˜ëŠ” í¬íŠ¸ë¡œ ë³€ê²½
```bash
[client-server] 
port = 3306  # ì´ê±¸ ì›í•˜ëŠ” í¬íŠ¸ë¡œ ë³€ê²½
```
3. ì œì¼ ì•„ë˜ì— ì¶”ê°€
```bash
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
collation-server = utf8mb4_unicode_ci
init-connect='SET NAMES utf8mb4'
character-set-client-handshake = FALSE
character-set-server = utf8mb4
default-time-zone='+9:00'
```
4. ì¬ì‹¤í–‰
```bash
# docker ì»¨í…Œë‹ˆì–´ bash ì—ì„œ ë‚˜ê°€ë ¤ë©´ exit ì…ë ¥
docker restart ì»¨í…Œì´ë„ˆID
```

### mysqlì ‘ì†
```bash
mysql -u root -p 
```
### mysql ìƒíƒœí™•ì¸
```bash
status
```
### mysql ì™¸ë¶€ì ‘ì† ê³„ì • ìƒì„±
mysql -u root -p  ì ‘ì† í›„
```bash
create user 'username'@'%' identified by 'password';
grant all privileges on *.* to 'username'@'%';
flush privileges;
```
---
  
## ğŸ‘•
## Redis ì„¤ì¹˜

1. docker pull redis
```bash
docker pull redis 
```
2. ì´ë¯¸ì§€ í™•ì¸
``` 
docker images
```
3. ë„ì»¤ë¡œ ë§Œë“¤ê¸°
```bash
sudo docker run -d -p 6380:6379 --name ì´ë¦„ redis --requirepass ë¹„ë²ˆ

# volume ë§ˆìš´íŠ¸
# docker run -v {ë¶ˆë¥¨ì´ë¦„orê²½ë¡œ}:{ë§ˆìš´íŠ¸í•  ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ} -d -p 3308:6379 --name {ì»¨í…Œì´ë„ˆ ì´ë¦„} redis --requirepass {ë¹„ë²ˆ}
docker run -v redisData:/data -d -p 3308:6379 --name redis redis --requirepass ssafy
```
4. ì ‘ì† í…ŒìŠ¤íŠ¸
```bash
docker exec -it ì»¨í…Œì´ë„ˆì•„ì´ë”” redis-cli 
```

## ğŸ‡  
## Certbot ì„¤ì •
### https ì„¤ì •ì„ ìœ„í•œ Certbot ì„¤ì •  

### Nginx ì„¤ì¹˜
```bash
sudo apt install -y nginx
```
### Certbot ì„¤ì¹˜
```bash
sudo snap install --classic certbot
```

### ì¸ì¦ì„œë°œê¸‰
```bash
sudo certbot --nginx -d {ë°œê¸‰ë°›ì„ ë„ë©”ì¸}

# ì´ë©”ì¼ ì…ë ¥
# ì„œë¹„ìŠ¤ ì•½ê´€ ë™ì˜
# 1. No redirect, Redirect ì„¤ì •
```

### SSL ìë™ ê°±ì‹ 
```bash
sudo certbot renew --dry-run

#Congraturation ëœ¨ë©´ ì ìš© ëœê²ƒ

# ìˆ˜ë™ ê°±ì‹  -> sudo certbot renew
```

### í‚¤ í™•ì¸
```bash
cd etc/letsencrypt/live/{ë„ë©”ì¸}
```

### pem ì¸ì¦ì„œ pkcs12ë¡œ ë³€í™˜
```bash
cd etc/letsencrypt/live/{ë„ë©”ì¸}

# openssl pkcs12 -export -inkey {privkey} -in {certificate} -out {pkcs12 í‚¤ ì´ë¦„}
openssl pkcs12 -export -inkey privkey.pem -in cert.pem -out ssafykey.p12
# ì´í›„ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
```
---
## ğŸƒ
## Nginx ì„¤ì •
1. Nginx ì„¤ì •
```bash
cd /etc/nginx/sites-enabled
nano default
```
2. defalut ì„¤ì • ë‚´ìš©
```bash
##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {
	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;
	
	ssl_certificate /etc/letsencrypt/live/j6b206.p.ssafy.io/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/j6b206.p.ssafy.io/privkey.pem;

#	root /var/www;
	root /var/jenkins/workspace/tnt/frontend/dist;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name j6b206.p.ssafy.io;

	location / {
#		try_files $uri $uri/ index.html;
		return 301 https://j6b206.p.ssafy.io$request_uri;
	}
	access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;
		
	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}
}


# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#	listen 80;
#	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
#}

server {

	# SSL configuration
	#
	#listen 443 ssl default_server;
	#listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/jenkins/workspace/tnt/frontend/dist;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;
        server_name j6b206.p.ssafy.io; # managed by Certbot


	#location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
	#	try_files $uri $uri/ index.html;
	#}
	
	location /jenkins {
            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_http_version 1.1;
            proxy_request_buffering off;
            proxy_pass http://j6b206.p.ssafy.io:9099;
            proxy_read_timeout 90;
        }
	
	#location /{
	#
	#}	

	#location /test{
	#	rewrite ^ http://j6b206.p.ssafy.io:9090? permanent;
	#}
	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}


    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/j6b206.p.ssafy.io/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/j6b206.p.ssafy.io/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
#server {
#    if ($host = j6b206.p.ssafy.io) {
#       return 301 https://$host$request_uri;
#    } # managed by Certbot
 
	
#	listen 80 ;
#	listen [::]:80 ;
#        server_name j6b206.p.ssafy.io;
#        return 404; # managed by Certbot
#}

```

3. Nginx êµ¬ë™
```bash
service nginx restart
```
---
## ğŸ
## Jenkins ë°°í¬

## 0. Jenkins Dockerë¡œ ì‹¤í–‰
```bash
## JAVA 11ë¡œ ì„¤ì¹˜
docker run -d -p 9090:8080 -p 50000:50000 --restart=always -v /var/jenkins:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock --name jenkins -u root jenkins/jenkins:lts-jdk11

# ì´ë¯¸ì§€ ë§í¬ https://hub.docker.com/r/jenkins/jenkins
```
## 1. Git ì—°ë™
> Git Plugin ì„¤ì¹˜

## 2. Node.js ì„¤ì¹˜
> Jenkins ê´€ë¦¬ -> Global Tool Configuration > Node.JS íƒ­ ì‘ì„±

## 3. í”„ë¡œì íŠ¸ ìƒì„± ë° ìƒì„±
> Freestyle project 
![image](https://user-images.githubusercontent.com/71022555/162229016-46d9a8bb-db28-46d7-b1e4-6ec76c3e1023.png)

- https ì¸ ê²½ìš° Credentals ìƒì„±í•´ì„œ í•´ë‹¹ Credentialsë¡œ ì„¸íŒ… í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

## 3-1 ë¹Œë“œ ìœ ë°œ
![image](https://user-images.githubusercontent.com/71022555/162229189-629c652b-565e-4ceb-b78e-cb58848e4470.png)  
- Push Eventsì¼ ë•Œ ì„¤ì •

## 3-2 ë¹Œë“œ ìœ ë°œ -> Secret token ë°œê¸‰ ë°›ê¸°
> ë¹Œë“œ ìœ ë°œ íƒ­ì—ì„œ Secret token -> Generate í†µí•´ í† í° ìƒì„± -> gitlabì—ì„œ ì‚¬ìš©
> ex) b356d45696925a2f09675c0ce64b0849
## 3-3 Build ì„¤ì •
```bash
# Execute shell ê¸°ì¤€
# í”„ë¡ íŠ¸ ë¶€ë¶„
cd frontend
npm install
npm run build

# ë°±ì—”ë“œ ë¶€ë¶„
cd ..
cd backend
chmod 755 gradlew
./gradlew clean build
docker stop tnt # ì²˜ìŒ ì‹¤í–‰í•  ë•Œ êµ¬ì„±ì—ì„œ ì œì™¸
docker rm tnt # ì²˜ìŒ ì‹¤í–‰í•  ë•Œ  êµ¬ì„±ì—ì„œ ì œì™¸ -> ì²˜ìŒì—ëŠ” tntë¼ëŠ” ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ì„œ ì˜¤ë¥˜ ë°œìƒí•©ë‹ˆë‹¤.
docker build -t yunghun97/tnt .
docker run --name tnt -d -p 9999:9999 yunghun97/tnt

# DockerFile(ë°±ì—”ë“œ ë£¨íŠ¸ ìœ„ì¹˜ì— ì¶”ê°€ë˜ì–´ ìˆë‹¤ê³  ê°€ì •)
## Docker file ì†ŒìŠ¤

#FROM openjdk:11
#ARG JAR_FILE=./build/libs/TNT_hadoop-0.0.1-SNAPSHOT
#copy ${JAR_FILE} tnt.jar
#ENTRYPOINT ["java", "-jar", "tnt.jar"]
#EXPOSE 9990
```

## 4 Git Lab ì„¤ì •
![image](https://user-images.githubusercontent.com/71022555/162230641-d5736cd4-50f1-47c0-ae10-68b20d5e889f.png)

> Setting -> Webhooks
## 4-1 WebHooks ì„¤ì •
![image](https://user-images.githubusercontent.com/71022555/162230863-fbb9c142-a813-440a-af1d-732a89188086.png)  
```bash
URL = ë„ë©”ì¸/project/í”„ë¡œì íŠ¸ëª…
token = ë°œê¸‰ë°›ì€ jenkins í”„ë¡œì íŠ¸ í† í°
```

## 4-2 ë°°í¬ í…ŒìŠ¤íŠ¸
![image](https://user-images.githubusercontent.com/71022555/162250788-2f442112-a4ba-4478-b1f4-a64e71a9d714.png)  

## 4-3 200 í™•ì¸
![image](https://user-images.githubusercontent.com/71022555/162250881-5a87e929-b30c-482b-b228-6ab8b8268d0d.png)
    
## 4-4 Jenkins í™•ì¸
![image](https://user-images.githubusercontent.com/71022555/162251895-1a88ebf4-6b3b-4360-b82e-205f0371ac55.png)

---
## ğŸ˜
## Hadoop ì„¤ì¹˜
## 1. ìš°ë¶„íˆ¬ ì»¨í…Œì´ë„ˆ ì„¤ì¹˜
```
docker run -i -t --name hadoop-base ubuntu 
```
ctrl + P, Q ë¡œ ì»¨í…Œì´ë„ˆ ì •ì§€í•˜ì§€ ì•Šê³  ì‰˜ ë¹ ì ¸ë‚˜ì˜¤ê¸° ê°€ëŠ¥
ë‹¨, docker run -it ì˜µì…˜ì¸ ê²½ìš°ì—ë§Œ ê°€ëŠ¥

## 2. open jdk ì„¤ì¹˜(ì»¨í…Œì´ë„ˆ)
```
add-apt-repository ppa:openjdk-r/ppa 
apt-get update  
apt-get install openjdk-8-jdk 
java -version 
```

## 3. í•˜ë‘¡ ì„¤ì¹˜ (ì»¨í…Œì´ë„ˆ)
```
apt-get install wget 
cd ~ 
mkdir soft 
cd soft/ 
mkdir apache 
cd apache/ 
mkdir hadoop 
cd hadoop/ 
wget http://mirrors.sonic.net/apache/hadoop/common/hadoop-2.7.7/hadoop-2.7.7.tar.gz 
tar xvzf hadoop-2.7.7.tar.gz 
```

## 4. bashrc ìˆ˜ì • (ì»¨í…Œì´ë„ˆ)
```
apt-get install vim -y 
vi ~/.bashrc 
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64 
export HADOOP_HOME=/root/soft/apache/hadoop/hadoop-2.7.7 
export HADOOP_CONFIG_HOME=$HADOOP_HOME/etc/hadoop 
export PATH=$PATH:$HADOOP_HOME/bin 
export PATH=$PATH:$HADOOP_HOME/sbin 
source ~/.bashrc 
```

## 5. ë””ë ‰í† ë¦¬ ìƒì„± ë° í•˜ë‘¡ ì„¤ì •íŒŒì¼ ìˆ˜ì • (ì»¨í…Œì´ë„ˆ)
```
cd $HADOOP_HOME/ 
mkdir tmp 
mkdir namenode 
mkdir datanode 
cd $HADOOP_CONFIG_HOME/ 
cp mapred-site.xml.template mapred-site.xml 
```

## 6. core, hdfs, mapred, yarn íŒŒì¼ ìˆ˜ì • (ì»¨í…Œì´ë„ˆ)
hadoop-env.sh
```
# ì¶”ê°€
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
```

core-site.xml
```
<configuration>
    <property>
            <name>hadoop.tmp.dir</name>
            <value>/root/soft/apache/hadoop/hadoop-2.7.7/tmp</value>
            <description>A base for other temporary directories.</description>
    </property>

    <property>
            <name>fs.default.name</name>
            <value>hdfs://master:9000</value>
            <final>true</final>
            <description>The name of the default file system.  A URI whose
            scheme and authority determine the FileSystem implementation.  The
            uri's scheme determines the config property (fs.SCHEME.impl) naming
            the FileSystem implementation class.  The uri's authority is used to
            determine the host, port, etc. for a filesystem.</description>
    </property>
</configuration>
```

hdfs-site.xml
```
<configuration>
    <property>
        <name>dfs.replication</name>
        <value>3</value>
        <final>true</final>
        <description>Default block replication.
        The actual number of replications can be specified when the file is created.
        The default is used if replication is not specified in create time.
        </description>
    </property>

    <property>
        <name>dfs.namenode.name.dir</name>
        <value>/root/soft/apache/hadoop/hadoop-2.7.7/namenode</value>
        <final>true</final>
    </property>

    <property>
        <name>dfs.datanode.data.dir</name>
        <value>/root/soft/apache/hadoop/hadoop-2.7.7/datanode</value>
        <final>true</final>
    </property>
</configuration>
```

mapred-site.xml
```
<configuration>
    <property>

        <name>mapreduce.framework.name</name>
        <value>yarn</value>
    </property>

    <property>

        <name>mapred.job.tracker</name>
        <value>master:9001</value>
        <description>The host and port that the MapReduce job tracker runs
        at.  If "local", then jobs are run in-process as a single map
        and reduce task.
        </description>
    </property>
</configuration>
```

yarn-site.xml
```
<configuration>

<!-- Site specific YARN configuration properties -->
  <property>
    <name>yarn.nodemanager.aux-services</name>
    <value>mapreduce_shuffle</value>
  </property>
  <property>
    <name>yarn.resourcemanager.address</name>
    <value>master:8032</value>
  </property>
  <property>
    <name>yarn.resourcemanager.scheduler.address</name>
    <value>master:8030</value>
  </property>
  <property>
    <name>yarn.resourcemanager.resource-tracker.address</name>
    <value>master:8031</value>
  </property>
  <property>
    <name>yarn.resourcemanager.admin.address</name>
    <value>master:8033</value>
  </property>
  <property>
    <name>yarn.resourcemanager.webapp.adress</name>
    <value>master:8088</value>
  </property>
</configuration>
```

## 7. ë„¤ì„ë…¸ë“œ í¬ë§· (ì»¨í…Œì´ë„ˆ)
```
hadoop namenode -format 
```

## 8. ssh ì„¤ì • (ì»¨í…Œì´ë„ˆ)
```
apt-get install ssh 
```
~/.bashrc ìˆ˜ì •
```
#autorun  
/usr/sbin/sshd
```

## 9. ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ commit (í˜¸ìŠ¤íŠ¸)
```
docker start <container id>
docker commit -m "hadoop install in ubunu" <container id> ubuntu:hadoop 
docker image ls 
```

## 10. master, slave ìƒì„± (í˜¸ìŠ¤íŠ¸)
```
docker run -i -t -h master --name master -p 50070:50070 -p 8088:8088 ubuntu:hadoop 
docker run -i -t -h slave1 --name slave1 --link master:master ubuntu:hadoop 
docker run -i -t -h slave2 --name slave2 --link master:master ubuntu:hadoop 
```

## 11. slave ì»¨í…Œì´ë„ˆ ip í™•ì¸ (í˜¸ìŠ¤íŠ¸)
```
docker inspect slave1 (172.17.0.4) 
docker inspect slave2 (172.17.0.5) 
```

## 12. í•˜ë‘¡ ì„¤ì • ë° êµ¬ë™ (ì»¨í…Œì´ë„ˆ)
```
docker attach master (ì ‘ì†. ì»¨í…Œì´ë„ˆëŠ” ì´ë¯¸ êµ¬ë™ì¤‘) 

vim /etc/hosts 
172.17.0.3		master
172.17.0.4      slave1 
172.17.0.5      slave2 
vim $HADOOP_CONFIG_HOME/slaves 

# ë°ì´í„°ë…¸ë“œê°€ ë  ì»¨í…Œì´ë„ˆ ëª©ë¡ë“¤.  
slave1 
slave2 
master 

start-all.sh 
```
hosts íŒŒì¼ì˜ ë‚´ìš©ì€ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘í•˜ë©´ ì•„ë˜ì—ì„œ ê¸°ì…í•œ ë‚´ìš©ì€ ì—†ì–´ì§„ë‹¤. ì¬ì‹œì‘í• ë•Œë§ˆë‹¤ ë‹¤ì‹œ ì…ë ¥í•˜ë“ ì§€, ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•  ë•Œ ì…ë ¥í•´ì£¼ëŠ” ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ë“ ì§€ í•˜ë©´ ëœë‹¤.

## 13. ì›Œë“œì¹´ìš´íŠ¸ í…ŒìŠ¤íŠ¸ (ì»¨í…Œì´ë„ˆ)
```
cd ~ 
cd soft/apache/hadoop/hadoop-2.7.7 
hadoop fs -mkdir /input 
hadoop fs -put LICENSE.txt /input 
hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.7.jar wordcount /input /output 
hadoop fs -cat /output/*
```

## 14. Resource manager ì›¹ UI í™•ì¸
http://<host ip>:8088 ì ‘ì†

![img](https://blog.kakaocdn.net/dn/eCtOU4/btqDA4KyP3s/ZKGYtmfBQuDPSo7aSVmLA0/img.png)   



---

## ğŸ’§
## Sqoop ì„¤ì¹˜
2.1. ë‹¤ìš´ë¡œë“œ

   - ìŠ¤ì¿± í”„ë¡œì íŠ¸ ì‚¬ì´íŠ¸ì—ì„œ ìµœì‹  ì•ˆì • ë°°í¬íŒì„ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ì ì ˆí•œ ìœ„ì¹˜ì— ì••ì¶• í•´ì œ

   - bin ë””ë ‰í† ë¦¬ ì•„ë˜ sqoop ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ì •ìƒ ì‹¤í–‰ ì—¬ë¶€ í™•ì¸

## ìµœê·¼ ì•ˆì • ë²„ì „ (1.4.7) ë‹¤ìš´ë¡œë“œ
```
wget http://mirror.navercorp.com/apache/sqoop/1.4.7/sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz
```
## ì••ì¶• í•´ì œ
```
tar xvf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz
```
## ì‹¤í–‰ í™•ì¸
```
cd sqoop-1.4.7.bin__hadoop-2.6.0
bin/sqoop help
```

2.2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

   - .bashrc íŒŒì¼ì— SQOOP_HOME ë° SCOOP_CONF_DIR ì„¤ì •

## í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ë¡œ .bashrc íŒŒì¼ ì—´ê¸° & ìŠ¤ì¿±ì˜ í™˜ê²½ë³€ìˆ˜ ì¶”ê°€ 
```
vi ~/.bashrc  
```
## scoop config 
```
export SQOOP_HOME=/home/hadoop/bigdata/sqoop-1.4.7.bin__hadoop-2.6.0 
export SQOOP_CONF_DIR=/home/<username>/<any directory>/sqoop-1.4.7.bin__hadoop-2.6.0/conf 
export PATH=$PATH:$SQOOP_HOME/bin 
```
   - sqoop-env.sh íŒŒì¼ì— í•˜ë‘¡ ê´€ë ¨ ì„¤ì •

## ìŠ¤ì¿± ì„¤ì¹˜í´ë”ì˜ conf ë””ë ‰í† ë¦¬ë¡œ ì´ë™
```
cd conf/
```
## sqoop-env-template.sh íŒŒì¼ì„ sqoop-env.sh ì´ë¦„ìœ¼ë¡œ ë°”ê¾¸ì–´ ë³µì‚¬  
```
cp sqoop-env-template.sh sqoop-env.sh  
```
## sqoop-env.sh íŒŒì¼ì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´  í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ë¡œ ì—´ê¸° 
```
vi sqoop-env.sh 
```
## hadoop ê´€ë ¨ ì„¤ì • 
```
export HADOOP_COMMON_HOME=/home/<username>/<any directory>/hadoop
export HADOOP_HOME=/home/<username>/<any directory>/hadoop 
export HADOOP_MAPRED_HOME=/home/<username>/<any directory>/hadoop
```

2.3. JDBC ì—°ê²° ì„¤ì •

   - ìŠ¤ì¿±ì€ JDBCë¥¼ í†µí•œ RDBMS ì—°ê²°ì„ ì§€ì›

   - ì—°ê²°í•˜ê³ ì í•˜ëŠ” DBMSì— ëŒ€í•œ JDBC ë“œë¼ì´ë²„ë¥¼ ë‹¤ìš´ë°›ì•„ $SQOOP_HOME/libì— ìœ„ì¹˜ ì‹œí‚¤ê³ 

   - SQOOP ì‹¤í–‰ ì‹œ JDBC ì—°ê²° ë¬¸ìì—´ì„ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©í•˜ì—¬ ì—°ê²°

## MySQL Connector/J 5.1.48 ë‹¤ìš´ë¡œë“œ & ì„¤ì¹˜ 

## https://dev.mysql.com/downloads/connector/j/ 
## Select Operating System ì½¤ë³´ë°•ìŠ¤ì—ì„œ Platform Independent ì„ íƒ
## "Looking for previous GA version?" ë§í¬ ì„ íƒ > *.tar.gz íŒŒì¼ ë‹¤ìš´ë¡œë“œ

## ì••ì¶• í•´ì œ 
```
tar xvf mysql-connector-java-5.1.48.tar.gz 
```
## jaríŒŒì¼ì„ cp ëª…ë ¹ì–´ë¡œ sqoopì˜ ë¼ì´ë¸ŒëŸ¬ ë¦¬ë¡œ ë³µì‚¬
```
cd mysql-connector-java-5.1.48
cp mysql-connector-java-5.1.48-bin.jar $SQOOP_HOME/lib 
```
â€» commons-lang-2.6.jar íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ì•„ $SQOOP_HOME/libì— ìœ„ì¹˜

   - sqoop import ìˆ˜í–‰ ì‹œ, java.lang.NoClassDefFoundError: org/apache/commons/lang/StringUtils ë°œìƒ

 

3. ìŠ¤ì¿± ì‹¤í–‰

3.1. import ë° export ì‘ì—… ìˆ˜í–‰

   - SQOOPì€ sqoop COMMAND [ARGS] í˜•íƒœë¡œ ì‹¤í–‰í•˜ë©°, sqoop help ì…ë ¥í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ í™•ì¸ ê°€ëŠ¥ 

   - classicmodelsì˜ customers í…Œì´ë¸”ì˜ ë³µì œ í…Œì´ë¸”ì„ customers_exportë¡œ ë§Œë“¤ì–´ ë‘ê³ 

     customers í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ import í•œ í›„, importí•œ ë°ì´í„°ë¥¼ customers_export í…Œì´ë¸”ì— export í•˜ê³ ì í•¨

## import (from classicmodels.customers to sqoop_out1 directory )
```
sqoop import --connect jdbc:mysql://localhost/classicmodels --table customers --target-dir sqoop_out1 --enclosed-by '\"' --username root -P 
```
## export (from sqoop_out1 to classicmodels.customers_export)
```
sqoop export --connect jdbc:mysql://localhost/classicmodels --table customers_export --export-dir sqoop_out1 --enclosed-by '\"' --username root -P
```
--enclosed-by '\"' : import / export ì‘ì—† ì‹œ í•„ë“œ êµ¬ë¶„ìë¡œ ','ë¥¼ ë””í´íŠ¸ë¡œ ì‚¬ìš©í•¨. customers í…Œì´ë¸”ì˜ í•„ë“œ ë‚´ ë¬¸ìì—´ì´ ','ë¥¼ í¬í•¨í•˜ê³  ìˆì–´ "ë¡œ í•„ë“œ ê°’ì„ ë‘˜ëŸ¬ ìŒˆ 

 

3.2. ê¸°íƒ€ ì‘ì—…

   - eval : SQL ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•¨

   - list-databases : ì„œë²„ì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ í‘œì‹œ

   - list-tables : ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì— ì ‘ê·¼ ê°€ëŠ¥í•œ í…Œì´ë¸” ëª©ë¡ í‘œì‹œ

## ì¡°íšŒ
```
sqoop eval --connect jdbc:mysql://localhost/classicmodels --username root -P --query 'SELECT customerNumber, customerName, phone, city, state FROM customers where country = "USA"'
```
## dml 
```
sqoop eval --connect jdbc:mysql://localhost/classicmodels --username root --P --e 'INSERT INTO customers_export VALUES (500, "Mad Cat, Inc", "Christmas", "Merry", "010-1234-5678", "500, BNL", null, "New York", null, null, "USA", null, null)'
```
## ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ ì¡°íšŒ
```
sqoop list-databases --connect jdbc:mysql://localhost/classicmodels --username root --P
```
## í…Œì´ë¸” ëª©ë¡ ì¡°íšŒ
```
sqoop list-tables --connect jdbc:mysql://localhost/classicmodels --username root --P
```

---
## ğŸ§­ 
## Oozie ì„¤ì¹˜
## Java
```
java -version
```

## Maven
```
mvn -version
```

## Hadoop
+ core-site.xml
```
 <property>
    <name>hadoop.proxyuser.root.groups</name>
    <value>*</value>
  </property>
  <property>
    <name>hadoop.proxyuser.root.hosts</name>
    <value>*</value>
  </property>
```
+ oozie ë””ë ‰í† ë¦¬ ìƒì„±
```
hadoop fs -mkdir /user/oozie
hadoop fs -chown oozie:hadoop /user/oozie
```

## MySQL
```
mysql --version
```

## Oozie ì†ŒìŠ¤ ë‹¤ìš´ë¡œë“œ ë° ë¹Œë“œ
```
wget http://apache.mirror.cdnetworks.com/oozie/4.3.1/oozie-4.3.1.tar.gz
tar -xvzf oozie-4.3.1.tar.gz -C /app/oozie/.
mv /app/oozie/oozie-4.3.1 /app/oozie/4.3.1
cd /app/oozie/4.3.1
vi pom.xml
```
ë¹Œë“œ
```
cd /app/oozie/4.3.1/bin
./mkdistro.sh -DskipTests
```

## oozie-site.xml
```
<configuration>
    <property>  
        <name>oozie.service.JPAService.jdbc.driver</name>  
        <value>com.mysql.jdbc.Driver</value>  
    </property>  

    <property>  
        <name>oozie.service.JPAService.jdbc.url</name>  
        <value>jdbc:mysql://localhost:3306/oozie</value>  
    </property>  

    <property>  
        <name>oozie.service.JPAService.create.db.schema</name>  
        <value>true</value>  
    </property>  

    <property>  
        <name>oozie.service.JPAService.jdbc.username</name>  
        <value>oozie</value>  
    </property>  

    <property>  
        <name>oozie.service.JPAService.jdbc.password</name>  
        <value>oozie</value>  
    </property>
</configuration>
```

## ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
```
mkdir /app/oozie/libext
cd /app/oozie/libext
find /app/hadoop/share/hadoop -name "*.jar" | xargs  -I {} cp {} .
cp /app/hive/lib/mysql-connector-java-5.1.47.jar .
wget http://archive.cloudera.com/gplextras/misc/ext-2.2.zip
```

## webapp ìƒì„±
```
oozie-setup.sh prepare-war 
```

## hadoopíŒŒì¼ì‹œìŠ¤í…œì— ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—…ë¡œë“œ
```
oozie-setup.sh sharelib create -fs hdfs://192.168.179.144:8020
```

## mysql ë©”íƒ€ë°ì´í„° ìƒì„±
```
ooziedb.sh create -sqlfile ooziedb_init_schema.sql -run
```

## Oozie ê¸°ë™ 
```
oozied.sh start
```
http://192.168.179.144:11000/oozie/ urlì—ì„œ web console ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

![img](https://oboki.net/workspace/wp-content/uploads/2019/03/web_console.png)

## ì¢…ë£Œ
```
oozied.sh stop
```


## ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰êµ¬ë™ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤.!! ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰
